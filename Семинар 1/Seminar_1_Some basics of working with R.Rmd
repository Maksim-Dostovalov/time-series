---
title: "Семинар 1. Введение в анализ временных рядов"
author: "Достовалов М.Ю."
date: "25.01.2024"
output:
  word_document: default
  html_document:
    df_print: paged
  pdf_document:
    df_print: paged
lang: "ru-russian"
---

1.  Введение данных «вручную». Численность населения РФ, млн.чел.

Создание вектора

```{r}
y=c(146.8, 146.9, 146.8, 146.7, 146.2, 145.6)
y
```

Создание ts объекта (временного ряда)

```{r}
year = ts(y, start=2017)
year
year1 = ts(c(146.8, 146.9, 146.8, 146.7, 146.2, 145.6), start=2017)
year1
```

Удаление вектора/объекта

```{r}
remove(year, year1)
```

Зададим переменные времени

```{r}
year = 2017:2022
year
t = 1:6
t
```

Обьединим переменные в одно множество с помощью команды column bind (cbind)

```{r}
cbind(t,year, y)
```

Создание квартального временного ряда начиная с III квартала 2017 года

```{r}
q = ts(y, start=c(2017,3), frequency=4) 
q
```

Построение графика ВР

```{r}
plot(y)
```

Добавим заголовок и подписи на график

```{r}
plot(year, y, 
     main = "Численность населения РФ",  # Заголовок графика
     xlab = "Годы",                      # Подпись оси X
     ylab = "Млн.чел.",                  # Подпись оси Y
     type = "o")                         # l-линия, р-точки, o-оба типа и пр.
```

2.  Различные типы ВР, анализ составляющих ВР.

Устанавим пакеты и подгрузим библиотеки для работы с данными

```{r message=FALSE, warning=FALSE}
# install.packages("tidyverse")
library(tidyverse)
```

Пример 1. Глобальное потепление (Global Warming): импорт данных в R.

Постройте график и проанализируйте динамику основного тренда.

```{r}
library(haven) # импортирует и экспортирует файлы SPSS, Stata
# file.choose()
globtemp = read_dta("globtemp.dta")  # укажите свой путь, где лежит файл
plot(globtemp$year, globtemp$g_temp,
     main="Среднегодовые отклонения глобальной температуры",
     xlab="Год",
     ylab="Отклонение, в градусах", 
     type="o")
```

Пример 2. Объём авиаперевозок в ЕС: ВР с сезонностью, импорт данных.

Загрузим данные из файла

```{r}
EU = read_dta("EU.dta")  # укажите свой путь, где лежит файл
```

Cоздадим ts обьект и зададим время

```{r}
eu1 = ts(EU$eu, start=c(2010,1), frequency=12) 
eu1
```

Построим график ВР

```{r}
plot.ts(eu1,
     main="Объём авиаперевозок в ЕС",
     ylab="Млн. человек", 
     xlab="t")
```

Пример 3. Индекс Доу-Джонса: высокочастотные ежедневные данные. \*19 октября 1987. Чёрный понедельник: индекс Доу-Джонса пережил самое большое падение в истории — на 22,6 %.

Загрузим данные из файла

```{r}
Dow = read_dta("dow1.dta")
```

Построим график ВР

```{r}
plot.ts(Dow$ln_dow, main="Индекс Доу-Джонса")
plot.ts(Dow$dowclose, main="Индекс Доу-Джонса")
```

Рассчитаем первую разность и для нее построим график

```{r}
d_dow = diff(Dow$ln_dow)
plot.ts(d_dow, main="DJ Доходность")
```

3.  Генерирование случайных процессов в R.

Сгенерируем белый шум (БМ) и построим график

```{r}
wn = rnorm(500,0,1) # 500 наблюдений N(0,1) 
plot.ts(wn, main="White noise")
```

Сгенерируем линейный тренд + БШ и построим график

```{r}
t = 1:500 # переменная времени от 1 до 500
tr1=0.1+0.01*t+wn
plot.ts (tr1, main="Линейный тренд")
```

Сгенерируем параболический тренд + БШ и построим график

```{r}
tr2=0.1+0.00005*t^2+wn
plot.ts (tr2, main="Параболический тренд")
```

Сгенерируем случайное блуждание/блуждание с дрейфом (2-е представление) и построим график

```{r}
set.seed(154) 
w = rnorm(200); x = cumsum(w) # две команды в одной строке задаются через ";"
wd = w +.2; xd = cumsum(wd)
plot.ts(xd, ylim=c(-5,55), main="Random walk", ylab='')
lines(x, col=4); abline(h=0, col=4, lty=2); abline(a=0, b=.2, lty=3)
```

4.  Стационарность ВР.

Построим график и найдем характеристики для сгенерированного БШ

```{r}
plot.ts(wn, main="White noise")
summary(wn)
```

Проверим его на стационарность

```{r}
library(psych)
describe(wn)
describe(wn[1:250])
describe(wn[251:500])
```

4.  Показатели динамики ВР.

Рассчитаем лаги и разности

```{r}
Ly=lag(y)
Dy=y-Ly
Ty= (y-Ly)/Ly*100
DLny=log(y/Ly)*100
cbind(y, Ly, Dy, Ty, DLny)
```

Построим столбиковую диаграмму

```{r}
barplot(Ty)
```
